

\documentclass[8pt,a4paper,spanish,openany]{article}
\usepackage[utf8]{inputenc}
\usepackage{ifpdf}
\usepackage{enumitem}
\usepackage{multicol}
\usepackage{setspace}
\usepackage[top=2.5cm,left=2.5cm,right=2.5cm,bottom=2.5cm,a4paper]{geometry}
\usepackage{longtable}
\usepackage[spanish]{babel}
\usepackage{forloop}
\usepackage{attachfile}
\usepackage{currfile}
\usepackage{color}
\usepackage{colortbl}
\usepackage{fancyhdr} % Required for custom headers
\usepackage{lastpage} % Required to determine the last page for the footer
\usepackage{extramarks} % Required for headers and footers

% Set up the header and footer
\pagestyle{fancy}
%\lhead{\hmwkAuthorName} % Top left header
\lhead{\hmwkClass}
\rhead{\hmwkTitle} % Top right header
\chead{} % Top center head
\lfoot{\scriptsize{\currfilename}} % Bottom left footer
\cfoot{} % Bottom center footer
\rfoot{ \scriptsize{\thepage\ / \protect\pageref{LastPage}}} % Bottom right footer
\renewcommand\headrulewidth{0pt} % Size of the header rule
\renewcommand\footrulewidth{0.4pt} % Size of the footer rule


\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=blue
}


\newcommand{\Width}{\textwidth}
\newcommand{\HalfWidth}{0.46\textwidth}
\newcommand{\Height}{0.95\textheight}
\newcommand{\HalfHeight}{0.45\textheight}



\newcommand{\HorizontalLine}
{
  \noindent\makebox[\linewidth]{\rule{\Width}{0.4pt}}
}

\newcommand{\IndentOn}{\setlength{\parindent}{12pt}}
\newcommand{\IndentOff}{\setlength{\parindent}{0pt}}

\newcounter{QuestionCounter}
\setcounter{QuestionCounter}{1}

\newenvironment{QuestionnaireQuestions}
{
  \begin{small}
    \setlength{\columnsep}{1cm}
    \noindent \begin{multicols}{2}
}
{
    \end{multicols}
  \end{small}
  \newpage
}

\newenvironment{QuestionnaireQuestion}[1][]
{
  \begin{minipage}{\HalfWidth}
    \HorizontalLine\\
    \arabic{QuestionCounter}. #1
    \begin{enumerate}[label=\alph*)]
}
{
    \end{enumerate}
  \end{minipage}

  \stepcounter{QuestionCounter}
}

\newcommand{\Answer}[1]{
  \item #1
}

\newenvironment{OpenQuestion}
{

  \begin{minipage}[t][\HalfHeight][t]{\Width}
    \HorizontalLine
    \arabic{QuestionCounter}.
}
{
    \vfill
  \end{minipage}
  \stepcounter{QuestionCounter}
  \\
}

\newenvironment{FullPageOpenQuestion}
{
  \clearpage
  \begin{minipage}[t][\Height][t]{\Width}
    \HorizontalLine
    \arabic{QuestionCounter}.
}
{
    \vfill
  \end{minipage}
  \stepcounter{QuestionCounter}
  \\
}


\newcommand{\Solution}[1]
{
  \ifpdf
    \pdfinfo{
      /Author (Alvaro Gonzalez Sotillo)
      /Title (Examen a partir de fichero GIFT y Latex, con Scala)
      /Keywords (PDF;LaTeX)
      /Subject (#1)
    }
  \fi
}

\newcommand{\Instructions}[2]
{
  \begin{small}
    Instrucciones generales para las preguntas cerradas:
    \begin{itemize}
      \item Marca solamente la respuesta más apropiada en cada caso, en la tabla de respuestas.
      \item No se tendrán en cuenta anotaciones fuera de la tabla de respuestas.
      \item Todas las preguntas tienen el mismo valor.
      \item Hay una, y sólo una, respuesta correcta en cada pregunta.
      \item Responde solamente las preguntas en las que estés seguro. Una respuesta incorrecta resta un tercio del valor de una respuesta acertada. Una pregunta sin responder no resta puntos.
    \end{itemize}

    Instrucciones generales para las preguntas abiertas:
    \begin{itemize}
      \item Es necesario responder a la pregunta y justificar dicha respuesta.
      \item Todas las preguntas tienen el mismo valor.
    \end{itemize}
    Puntuación:
    \begin{itemize}
      \item La parte tipo test es un  #1\% de la nota.
      \item La parte de preguntas abiertas es un #2\% de la nota.
      \item Se necesita un mínimo de 3,5 en cada parte del examen para que hagan media.
    \end{itemize}
  \end{small}
}

\usepackage{fancybox}

\newenvironment{ShadowBox}[2][0.04cm]
{
  \fboxrule=#1
  \newsavebox{\fmboxx}
  \begin{lrbox}{\fmboxx}
    \begin{minipage}{#2}

}
{
    \end{minipage}
  \end{lrbox}
  \fbox{\usebox{\fmboxx}}
}

\newcommand{\StudentData}
{
    \begin{ShadowBox}{\Width}
      \vspace{0.2cm}
      \large{
        \textbf{Nombre} \\
        \textbf{Grupo} \\
        \textbf{Fecha}
      }
      \vspace{0.2cm}
    \end{ShadowBox}
  \\
}


\newcommand{\FileAutoref}[0]{
	\attachfile[mimetype=text/plain,
	            description={El fichero TEX original para crear este documento, no sea que se nos pierda},
	            subject={El fichero TEX original para crear este documento, no sea que se nos pierda}]
	  {\currfilename}
}

\newcommand{\TableLoopHLine}{}
\newcommand{\TableLoopInternal}[4]
{%
  \ifthenelse{\value{#2} = \value{EndOfTableLoop}  \OR \value{#2} > \value{EndOfTableLoop} }
  {
      \addtocounter{#2}{1}%
      #4 \\ \TableLoopHLine%
    \end{tabular}
  }
  {
    \ifthenelse{\value{#2} = 0}%
    {%
      \begin{tabular}{#3}%
        \TableLoopHLine %
        \addtocounter{#2}{1}%

        #4 \\ \TableLoopHLine%
        \TableLoopInternal{#1}{#2}{#3}{#4}%
    }%
    {%
      \ifthenelse{\value{#2} < \value{EndOfTableLoop}}%
      {%
        \addtocounter{#2}{1}%

        #4 \\ \TableLoopHLine%
        \TableLoopInternal{#1}{#2}{#3}{#4}%
      }%
      {
      }
    }
  }
}%

\newcommand{\TableLoop}[4]
{
  % #1: number of rows
  % #2: counter of row, 1 up to rows
  % #3: colum definitions
  % #4: body of each row

  \newcounter{EndOfTableLoop}
  \setcounter{EndOfTableLoop}{#1}
  \addtocounter{EndOfTableLoop}{-1}
  \setcounter{#2}{0}
  \TableLoopInternal{#1}{#2}{#3}{#4}
}


\newcommand{\HorizontalAnswerTable}[1]
{
  \vspace{0.5cm}

  \newcounter{AnswerTableC}
  \setcounter{AnswerTableC}{1}
  \newcounter{AnswerCounter}


  \newcommand{\AnswerCell}
  {
    \ifthenelse{\value{AnswerTableC}>#1}
    {
      \begin{tabular}{p{0.5cm}p{1.5cm}}
         &  \\
      \end{tabular}
    }
    {
      \begin{tabular}{|p{0.5cm}|p{1.5cm}|}
        \hline
        \cellcolor{black}\textcolor{white}{\textbf{\arabic{AnswerTableC}}} &  \\
        \hline
      \end{tabular}
    }
    \hspace{0.3mm}
    \addtocounter{AnswerTableC}{1}
  }

  \forloop[5]{AnswerCounter}{1}{\value{AnswerTableC}<#1 \OR \value{AnswerTableC}=#1}
  {
    \AnswerCell
    \AnswerCell
    \AnswerCell
    \AnswerCell
    \AnswerCell
  }

  \newpage
}

\newcommand{\VerticalAnswerTable}[1]
{
  \vspace{0.5cm}
  \newcounter{AnswerTableC}
  \begin{multicols}{5}
    \forloop{AnswerTableC}{1}{\value{AnswerTableC}<#1 \OR \value{AnswerTableC}=#1}
    {
      \begin{tabular}{|p{0.5cm}|p{1.5cm}|}
        \hline
        \cellcolor{black}\textcolor{white}{\textbf{\arabic{AnswerTableC}}} & \\
        \hline
      \end{tabular}
    }
  \end{multicols}
  \newpage
}

\newcommand{\AnswerTable}[1]{
  \begin{ShadowBox}[0.2cm]{\Width}
    \VerticalAnswerTable{#1}
  \end{ShadowBox}
  \HorizontalAnswerTable{#1}
}

\begin{document}

%\FileAutoref

\IndentOff

\StudentData


${GeneratedContent}


\end{document}
